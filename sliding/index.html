<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ìŠ¬ë¼ì´ë”© ë¶™ë°•ì´ì¥ ìë™ ì„¤ê³„ ê³„ì‚°ê¸° (COMPACT Â· ì €ì¥ í¬í•¨)</title>
<style>
  :root{
    --blue:#2563eb; --muted:#6b7280; --red:#d12c2c; --black:#111;
    --bg:#f7f8fb; --card:#fff; --border:#e5e7eb;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#1f2937;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif}
  .container{max-width:1000px;margin:0 auto;padding:20px 14px 160px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 14px rgba(0,0,0,.05);padding:16px;margin-bottom:16px}
  h1{margin:0 0 8px;font-size:20px} h2{margin:0 0 12px;font-size:16px}
  .muted{color:var(--muted);font-size:13px}
  input[type="number"]{width:100%;padding:8px 10px;border:1px solid #cbd5e1;border-radius:8px}
  label.inline{display:flex;align-items:center;gap:8px}
  .checks{display:flex;gap:12px;flex-wrap:wrap}
  .btn{border:0;border-radius:10px;background:var(--blue);color:#fff;padding:9px 14px;cursor:pointer;font-size:14px}
  .btn.ghost{background:transparent;color:var(--blue);border:1px solid var(--blue)}
  .summary-line{margin:6px 0}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:760px){.row{grid-template-columns:1fr}}
  .slot{border:1px solid #eaf0f5;border-radius:12px;padding:10px;margin-bottom:12px}
  .slot h3{margin:0 0 8px;font-size:14px;display:flex;justify-content:space-between;align-items:center}
  .thumb-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .thumb{border:2px solid transparent;border-radius:10px;overflow:hidden;background:#fff;cursor:pointer}
  .thumb.active{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.2)}
  .thumb img{display:block;width:100%;height:auto}
  .preview-box{border:1px solid var(--border);border-radius:12px;background:#fff;display:flex;justify-content:center;align-items:center;min-height:140px;overflow:auto}
  .seq{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;font-family:ui-monospace,Menlo,Consolas,monospace}
  .seq .r{ color:#d12c2c; font-weight:600; } /* í†µ(ë¹¨ê°•) */
  .seq .k{ color:#111; font-weight:700; } /* ì„œë¼ìš´ë“œ(L/R=ê²€ì •) */
  .sticky{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,.97);border-top:1px solid var(--border);backdrop-filter:blur(6px);padding:10px 14px;display:grid;grid-template-columns:1fr auto;gap:10px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>ğŸ“ ìŠ¬ë¼ì´ë”© ë¶™ë°•ì´ì¥ ìë™ ì„¤ê³„ ê³„ì‚°ê¸°</h1>
    <div class="muted">
      ì‘ì€ì¥ ì—†ìŒ Â· í—ˆìš© í­: <b>800 / 850 / 900 / 950 / 1000</b> Â· ë„ì–´(=í†µ) ê°œìˆ˜ ìë™ íƒìƒ‰ <b>2~4</b><br/>
      <b>ì„œë¼ìš´ë“œ ìë™ ê³„ì‚°(ìµœì†Œ 40mm/ì¸¡)</b> Â· ë¯¸ë¦¬ë³´ê¸°ëŠ” í†µë¼ë¦¬ <b>ì™„ì „ ë°€ì°©</b>
    </div>
  </div>

  <div class="card">
    <h2>ì…ë ¥</h2>
    <div class="summary-line">
      <label>ë²½ ì „ì²´ ê¸¸ì´ (mm)<br>
        <input id="wall" type="number" value="3600" min="1000" placeholder="ì˜ˆ: 3600">
      </label>
    </div>

    <div class="summary-line">
      <b>í—ˆìš© í­ (ëª¨ë‘ ë™ì¼í­ ì‚¬ìš©)</b>
      <div class="checks">
        <label class="inline"><input type="checkbox" id="w1000" checked> 1000</label>
        <label class="inline"><input type="checkbox" id="w950" checked> 950</label>
        <label class="inline"><input type="checkbox" id="w900" checked> 900</label>
        <label class="inline"><input type="checkbox" id="w850" checked> 850</label>
        <label class="inline"><input type="checkbox" id="w800" checked> 800</label>
      </div>
      <div class="muted">â€» ìŠ¬ë¼ì´ë”©ì€ í†µë§ˆë‹¤ í­ì´ ëª¨ë‘ ë™ì¼í•©ë‹ˆë‹¤.</div>
    </div>

    <div class="summary-line">
      <b>ë„ì–´(=í†µ) ê°œìˆ˜</b>
      <div class="checks">
        <label class="inline"><input type="checkbox" id="d2" checked> 2ê°œ</label>
        <label class="inline"><input type="checkbox" id="d3" checked> 3ê°œ</label>
        <label class="inline"><input type="checkbox" id="d4" checked> 4ê°œ</label>
      </div>
    </div>

    <button class="btn" id="calcBtn">ê³„ì‚°í•˜ê¸°</button>
    <div id="summary" style="margin-top:10px;"></div>
  </div>

  <div class="card" id="designCard" style="display:none;">
    <h2>ë””ìì¸ ì„ íƒ (A~I)</h2>
    <div class="row">
      <div>
        <div id="slotsWrap"></div>
      </div>
      <div>
        <div class="preview-box"><canvas id="previewCanvas"></canvas></div>

        <div style="margin-top:12px">
          <label>COMPACT ì‹œí€€ìŠ¤ <small>(ê³µë°± ì—†ìŒ Â· <span class="k">ê²€ì •=L/R</span>, <span class="r">ë¹¨ê°•=ê° í†µ</span>)</small></label>
          <div id="seqCompact" class="seq">-</div>
          <button class="btn" style="margin-top:8px" onclick="copyCompact()">ë³µì‚¬</button>
          <div class="muted" style="margin-top:8px">
            â€¢ ë³µì‚¬í•œ ê²°ê³¼ëŠ” <b>ìƒí’ˆ ì˜µì…˜ ì²« ì¹¸(ì‚¬ì´ì¦ˆ&ë””ìì¸ êµ¬ì„±)</b>ì— ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.<br/>
            â€¢ <span class="r">ë¹¨ê°•</span>ìœ¼ë¡œ í‘œì‹œëœ <b>í†µ(ì˜ˆ: 9A, 9Fâ€¦)</b>ë§Œ ì¥ë°”êµ¬ë‹ˆì— ìˆœì„œëŒ€ë¡œ ë‹´ì•„ ì£¼ì„¸ìš”. (L/Rì€ ì„œë¼ìš´ë“œë¼ ë‹´ì§€ ì•ŠìŒ)
          </div>
        </div>

        <div style="margin-top:14px">
          <button class="btn" onclick="downloadPreview()">ìµœì¢…ì´ë¯¸ì§€ ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="sticky">
  <div class="muted">ê³„ì‚° â†’ ì¶”ì²œì•ˆ ì„ íƒ â†’ ë””ìì¸ ì„ íƒ â†’ ì‹œí€€ìŠ¤/ì´ë¯¸ì§€ ì €ì¥</div>
  <button class="btn" onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>
</div>

<script>
  // ------- ì„¤ì •
  const MIN_SURROUND = 40;
  const DOOR_COUNTS = [2,3,4]; // ìŠ¬ë¼ì´ë”©: ë„ì–´ ìˆ˜(=í†µ ê°œìˆ˜)
  const WIDTHS_ALL = [1000,950,900,850,800]; // í—ˆìš© í­(ë™ì¼í­)

  const LETTERS = ["A","B","C","D","E","F","G","H","I"];
  const IMG = Object.fromEntries(LETTERS.map(ch => [ch, `design_${ch}.png`]));

  let topPlans = [];
  let currentPlan = null;
  let selections = [];

  document.getElementById('calcBtn').addEventListener('click', calculate);
  document.getElementById('wall').addEventListener('keydown', e=>{ if(e.key==='Enter') calculate(); });

  function enabledDoorCounts(){
    const list=[];
    if(document.getElementById('d2').checked) list.push(2);
    if(document.getElementById('d3').checked) list.push(3);
    if(document.getElementById('d4').checked) list.push(4);
    return list;
  }
  function enabledWidths(){
    const list=[];
    if(document.getElementById('w1000').checked) list.push(1000);
    if(document.getElementById('w950').checked) list.push(950);
    if(document.getElementById('w900').checked) list.push(900);
    if(document.getElementById('w850').checked) list.push(850);
    if(document.getElementById('w800').checked) list.push(800);
    return list;
  }

  function calculate(){
    const wall = parseInt(document.getElementById('wall').value,10);
    const summary = document.getElementById('summary');
    summary.innerHTML = "";
    document.getElementById('designCard').style.display="none";

    if(!wall || wall<1000){ summary.innerHTML = "<div style='color:#b00020'>âš ï¸ 1000mm ì´ìƒ ì…ë ¥</div>"; return; }

    const widths = enabledWidths();
    const doors = enabledDoorCounts();
    if(widths.length===0){ summary.innerHTML = "<div style='color:#b00020'>âš ï¸ ìµœì†Œ 1ê°œ í­ì„ ì„ íƒ</div>"; return; }
    if(doors.length===0){ summary.innerHTML = "<div style='color:#b00020'>âš ï¸ ìµœì†Œ 1ê°œ ë„ì–´ ìˆ˜ë¥¼ ì„ íƒ</div>"; return; }

    let candidates = [];
    for(const d of doors){
      for(const w of widths){
        const used = d*w;
        if(used>wall) continue;
        const leftover = wall - used;
        const surround = leftover/2;
        if(surround < MIN_SURROUND) continue;
        candidates.push({doors:d, width:w, used, leftover, surround});
      }
    }
    if(candidates.length===0){ summary.innerHTML = "<div style='color:#b00020'>ì¡°ê±´ì— ë§ëŠ” ì¡°í•© ì—†ìŒ</div>"; return; }

    // ì •ë ¬: ì„œë¼ìš´ë“œ ìµœì†Œ(=leftover ìµœì†Œ) â†’ í­ í° ê²ƒ ìš°ì„  â†’ ë„ì–´ ìˆ˜ ì ì€ ê²ƒ ìš°ì„ 
    candidates.sort((a,b)=>{
      if(a.leftover!==b.leftover) return a.leftover - b.leftover;
      if(a.width!==b.width) return b.width - a.width;
      return a.doors - b.doors;
    });
    topPlans = candidates.slice(0,3);

    summary.innerHTML = "<div style='color:#087443'><b>âœ… ì¶”ì²œ ì¡°í•© Top3 (ì„œë¼ìš´ë“œ ìš°ì„ )</b></div>" +
      topPlans.map((p,i)=>`
        <div class="summary-line">
          <button class="btn ghost" onclick="choosePlan(${i})">${i+1}ì•ˆ ì„ íƒ</button>
          í­ <b>${p.width}mm</b> Ã— ë„ì–´ <b>${p.doors}ê°œ</b>
          Â· ì„œë¼ìš´ë“œ <b>${Math.round(p.surround)}mm</b>/ì¸¡ (ë‚¨ëŠ”í­ ${p.leftover}mm)
        </div>
      `).join("");
  }

  function choosePlan(idx){
    const p = topPlans[idx];
    currentPlan = p;
    selections = Array(p.doors).fill("A");

    const wrap = document.getElementById('slotsWrap');
    wrap.innerHTML = "";
    for(let i=0;i<p.doors;i++){
      const slot = document.createElement('div');
      slot.className = "slot";
      slot.innerHTML = `<h3>${i+1}í†µ <span class="muted">${p.width}mm</span></h3>`;
      const grid = document.createElement('div');
      grid.className = "thumb-grid";
      LETTERS.forEach(letter=>{
        const div=document.createElement('div');
        div.className="thumb"+(letter==="A"?" active":"");
        const img=document.createElement('img');
        img.src=IMG[letter]; img.alt=letter;
        div.appendChild(img);
        div.addEventListener('click',()=>{
          selections[i]=letter;
          grid.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active'));
          div.classList.add('active');
          updateSequence(); renderPreview();
        });
        grid.appendChild(div);
      });
      slot.appendChild(grid);
      wrap.appendChild(slot);
    }

    document.getElementById('designCard').style.display="block";
    updateSequence(); renderPreview();
    window.scrollTo({ top: document.getElementById('designCard').offsetTop - 10, behavior:'smooth' });
  }

  // ---------- ì‹œí€€ìŠ¤ (ë””ì‹œë¯¸í„° í‘œê¸°, ê³µë°± ì—†ìŒ / í†µ=ë¹¨ê°•, ì„œë¼ìš´ë“œ=ê²€ì •)
  function mmToDmStr(mm){
    // 100mm = 1dm
    const dm = mm/100;
    return (Math.round(dm*10)/10).toString().replace(/\.0$/,''); // 9.0 -> 9
  }

  function buildCompactSequence(){
    if(!currentPlan) return {html:"-", text:"-"};
    const widthDm = mmToDmStr(currentPlan.width);
    const surrDm = mmToDmStr(Math.round(currentPlan.surround)*10); // mm â†’ dm
    const left = `<span class="k">${surrDm}L</span>`;
    const right = `<span class="k">${surrDm}R</span>`;
    const mids = selections.map(ch=> `<span class="r">${widthDm}${ch}</span>`);
    const html = [left, ...mids, right].join('-');
    const text = html.replace(/<[^>]+>/g,''); // íƒœê·¸ ì œê±° í…ìŠ¤íŠ¸
    return {html, text};
  }

  function updateSequence(){
    const out = buildCompactSequence();
    const box = document.getElementById('seqCompact');
    box.innerHTML = out.html;
    box.dataset.copy = out.text;
  }

  function copyCompact(){
    const box = document.getElementById('seqCompact');
    const raw = box.dataset.copy || box.textContent;
    navigator.clipboard.writeText(raw).then(()=>alert('ë³µì‚¬ë¨'));
  }

  // ---------- ë¯¸ë¦¬ë³´ê¸° (í†µë¼ë¦¬ ì™„ì „ ë°€ì°©, ì„œë¼ìš´ë“œ í‘œì‹œ, ìŠ¬ë¼ì´ë”©ì€ ì¤‘ì•™ 3mm ì„  ì—†ìŒ)
  async function renderPreview(){
    const canvas=document.getElementById('previewCanvas'), ctx=canvas.getContext('2d');
    if(!currentPlan){canvas.width=0;canvas.height=0;return;}
    const unitH=260, labelH=26, gap=0;
    let pxPerMm=0.16;

    const totalMm = currentPlan.width * currentPlan.doors;
    let sPx = Math.max(3, Math.round(currentPlan.surround*pxPerMm));
    let totalW = sPx + totalMm*pxPerMm + gap*(currentPlan.doors-1) + sPx;
    const maxW=1200;
    if(totalW>maxW){
      const mmPart=(totalMm*pxPerMm)+(2*sPx);
      const scale=(maxW - gap*(currentPlan.doors-1)) / mmPart;
      pxPerMm*=scale; sPx=Math.max(3,Math.round(currentPlan.surround*pxPerMm));
      totalW=Math.round(sPx + totalMm*pxPerMm + gap*(currentPlan.doors-1) + sPx);
    }
    canvas.width=totalW; canvas.height=unitH+labelH;

    ctx.fillStyle="#fff"; ctx.fillRect(0,0,canvas.width,canvas.height);

    // ì¢Œ ì„œë¼ìš´ë“œ
    let x=0;
    ctx.fillStyle="#f0f0f0"; ctx.fillRect(x,0,sPx,unitH);
    ctx.strokeStyle="#cfcfcf"; ctx.strokeRect(x+0.5,0.5,sPx-1,unitH-1);
    ctx.fillStyle="#555"; ctx.font="12px system-ui"; ctx.textAlign="center";
    ctx.fillText(`L${Math.round(currentPlan.surround)}mm`, x + sPx/2, unitH-8);
    x+=sPx;

    for(let i=0;i<currentPlan.doors;i++){
      const mm=currentPlan.width, w=mm*pxPerMm;
      const letter=selections[i], src=IMG[letter];
      try{
        const img=await loadImage(src);
        const ratio=Math.min(w/img.width, unitH/img.height);
        const dw=Math.round(img.width*ratio), dh=Math.round(img.height*ratio);
        const ix=x + Math.round((w-dw)/2), iy=Math.round((unitH-dh)/2);
        ctx.drawImage(img, ix, iy, dw, dh);
      }catch(e){
        ctx.strokeStyle="#999"; ctx.strokeRect(x+4,4,w-8,unitH-8);
        ctx.fillStyle="#333"; ctx.font="bold 22px system-ui"; ctx.textAlign="center";
        ctx.fillText(letter, x + w/2, unitH/2 + 8);
      }
      // í•˜ë‹¨ í­ ë¼ë²¨
      ctx.fillStyle="#111"; ctx.font="12px system-ui"; ctx.textAlign="center";
      ctx.fillText(`${mm}mm`, x + w/2, unitH + labelH - 8);
      x += w + (i<currentPlan.doors-1 ? gap : 0);
    }

    // ìš° ì„œë¼ìš´ë“œ
    ctx.fillStyle="#f0f0f0"; ctx.fillRect(x,0,sPx,unitH);
    ctx.strokeStyle="#cfcfcf"; ctx.strokeRect(x+0.5,0.5,sPx-1,unitH-1);
    ctx.fillStyle="#555"; ctx.fillText(`R${Math.round(currentPlan.surround)}mm`, x + sPx/2, unitH-8);
  }

  function loadImage(src){ return new Promise((res,rej)=>{ const i=new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=src; }); }

  // ìµœì¢…ì´ë¯¸ì§€ ì €ì¥
  function downloadPreview(){
    const c=document.getElementById('previewCanvas');
    if(!c||c.width===0){ alert("ë¨¼ì € ë””ìì¸ì„ ì„ íƒí•˜ì„¸ìš”."); return; }
    const a=document.createElement('a'); a.href=c.toDataURL("image/png"); a.download="ìµœì¢…ì¡°ë¦½ë¯¸ë¦¬ë³´ê¸°.png"; a.click();
  }
</script>
</body>
</html>