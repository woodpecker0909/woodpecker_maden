<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ë¶™ë°•ì´ì¥ ìë™ ì„¤ê³„ ê³„ì‚°ê¸° â€“ Compact ì‹œí€€ìŠ¤(L/R ìˆ«ì)</title>
<style>
  :root{
    --bg:#f5f7fb; --card:#fff; --text:#1f2937; --muted:#6b7280;
    --brand:#0f7bff; --line:#e5e7eb; --chip-bg:#eef2ff; --chip-bd:#c7d2fe;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
       font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif}
  .container{max-width:1000px;margin:0 auto;padding:20px 14px 170px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;
        padding:16px;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,.05)}
  h1{font-size:20px;margin:0 0 8px}
  h2{font-size:16px;margin:0 0 12px}
  .muted{font-size:13px;color:var(--muted)}
  .btn{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border-radius:8px;border:0;
       background:var(--brand);color:#fff;cursor:pointer;font-size:14px}
  .btn.ghost{background:transparent;color:var(--brand);border:1px solid var(--brand)}
  .ok{color:#087443}.warn{color:#b00020}
  .slot{border:1px solid #e5f0f5;border-radius:12px;padding:10px;margin-bottom:12px}
  .slot h3{margin:0 0 8px;font-size:14px;display:flex;justify-content:space-between;align-items:center}
  .chip{font-size:11px;padding:2px 8px;border-radius:999px;background:var(--chip-bg);
        color:#1e3a8a;border:1px solid var(--chip-bd)}
  .thumb-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .thumb{border:2px solid transparent;border-radius:10px;overflow:hidden;cursor:pointer;background:#fff}
  .thumb img{display:block;width:100%;height:auto}
  .thumb.active{border-color:#2563eb;box-shadow:0 0 0 3px rgba(37,99,235,.2)}
  .seq{background:#fff;border:1px solid var(--line);border-radius:10px;padding:10px;font-family:monospace}
  .checks{display:flex;gap:12px;flex-wrap:wrap;margin:6px 0 8px}
  .sticky-bar{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,.96);
              border-top:1px solid var(--line);backdrop-filter:blur(6px);
              padding:10px 14px;display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
  .summary-line{margin:6px 0}
  .preview-wrap{display:flex;flex-direction:column;gap:8px}
  .preview-box{border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff;
               display:flex;justify-content:center;align-items:center;min-height:120px;overflow:auto}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:760px){.row{grid-template-columns:1fr}}
  input[type="number"]{padding:8px;border-radius:8px;border:1px solid #cbd5e1;width:100%}
  label.inline{display:flex;align-items:center;gap:8px}
  small.tip{display:block;color:#334155;margin-top:6px}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ğŸ“ ë¶™ë°•ì´ì¥ ìë™ ì„¤ê³„ ê³„ì‚°ê¸°</h1>
      <div class="muted">
        <b>ì‹¤ì œ í­(mm) ë¹„ìœ¨ Â· í°ì¥ ì¤‘ì•™ 3mm ê°„ê²©</b> Â·
        <b>ì‘ì€ì¥: ë†’ì´ ë™ì¼, í­ë§Œ ì ˆë°˜</b> Â· <b>ìµœì†Œ ì„œë¼ìš´ë“œ 40mm</b>
      </div>
    </div>

    <div class="card">
      <h2>ì…ë ¥</h2>
      <div class="summary-line">
        <label>ë²½ ì „ì²´ ê¸¸ì´ (mm)<br>
          <input id="wall" type="number" value="3600" min="1000" placeholder="ì˜ˆ: 3600">
        </label>
      </div>
      <div class="summary-line">
        <b>í—ˆìš© ì„¸íŠ¸(ì§ ê·œê²©)</b>
        <div class="checks">
          <label class="inline"><input type="checkbox" id="set1000" checked> 1000 + 500</label>
          <label class="inline"><input type="checkbox" id="set950"  checked> 950 + 475</label>
          <label class="inline"><input type="checkbox" id="set900"  checked> 900 + 450</label>
          <label class="inline"><input type="checkbox" id="set850"  checked> 850 + 425</label>
          <label class="inline"><input type="checkbox" id="set800"  checked> 800 + 400</label>
        </div>
        <small class="tip">í•œ ë²ˆì— í•˜ë‚˜ì˜ ì„¸íŠ¸ë¡œë§Œ ì¡°í•©í•©ë‹ˆë‹¤(ë¬¸ì§ ë„ˆë¹„ í†µì¼).</small>
      </div>
      <div class="summary-line">
        <b>ì¶”ê°€ ì˜µì…˜</b>
        <div class="checks">
          <label class="inline"><input type="checkbox" id="pairRequired"> í°ì¥Â·ì‘ì€ì¥ ìµœì†Œ 1ê°œì”©(ì§ í•„ìˆ˜)</label>
          <label class="inline"><input type="checkbox" id="onlyOddDoors"> í™€ìˆ˜ ë„ì–´ë§Œ</label>
        </div>
      </div>
      <button class="btn" id="calcBtn">ê³„ì‚°í•˜ê¸°</button>
      <div id="summary" style="margin-top:10px;"></div>
    </div>

    <div class="card" id="designCard" style="display:none;">
      <h2>ë””ìì¸ ì„ íƒ (A~I)</h2>
      <div class="row">
        <div><div id="slotsWrap"></div></div>

        <div class="preview-wrap">
          <div><b>ë¯¸ë‹ˆ ì¡°ë¦½ ë¯¸ë¦¬ë³´ê¸°</b></div>
          <div class="preview-box"><canvas id="previewCanvas"></canvas></div>
          <div class="muted">ì¢Œ/ìš° ì„œë¼ìš´ë“œ, ê° í†µ í­(mm), í°ì¥ ì¤‘ì•™ <b>3mm</b> ê°„ê²© í‘œì‹œ</div>

          <div style="margin-top:12px;">
            <label>ë””ìì¸ ì‹œí€€ìŠ¤(ë¬¸ì)</label>
            <div id="sequenceBoxLetters" class="seq">-</div>
            <button class="btn" style="margin-top:8px;" onclick="copyText('sequenceBoxLetters')">ë³µì‚¬</button>
          </div>

          <div style="margin-top:12px;">
            <label>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì…ë ¥ìš© ì‹œí€€ìŠ¤(ì„œë¼ìš´ë“œ í¬í•¨ Â· Compact)</label>
            <div id="sequenceBoxCompact" class="seq">-</div>
            <div class="muted" style="margin-top:6px;">
              ë³µì‚¬í•œ ê²°ê³¼ëŠ” <b>ìƒí’ˆ ì˜µì…˜ ì²« ì¹¸(ì‚¬ì´ì¦ˆ&ë””ìì¸ êµ¬ì„±)</b>ì— ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.
            </div>
            <button class="btn" style="margin-top:8px;" onclick="copyText('sequenceBoxCompact')">ë³µì‚¬</button>
          </div>

          <div style="margin-top:12px;">
            <label>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì…ë ¥ìš© ì‹œí€€ìŠ¤(ì„œë¼ìš´ë“œ í¬í•¨ Â· ìƒì„¸)</label>
            <div id="sequenceBoxFull" class="seq">-</div>
            <button class="btn" style="margin-top:8px;" onclick="copyText('sequenceBoxFull')">ë³µì‚¬</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sticky-bar">
    <div class="muted">ê³„ì‚° â†’ ì¶”ì²œì•ˆ ì„ íƒ â†’ ë””ìì¸ ì„ íƒ â†’ ì‹œí€€ìŠ¤ ë³µì‚¬ & ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ì €ì¥</div>
    <button class="btn" onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>
  </div>

<script>
  // ----- ìƒìˆ˜ -----
  const MIN_SURROUND = 40;       // ìµœì†Œ ì„œë¼ìš´ë“œ(mm)
  const LEFTOVER_TIE_MM = 20;    // ë‚¨ëŠ”í­ ë™ë¥  íŒë‹¨ ì—¬ìœ 
  const DOOR_GAP_MM = 3;

  // ì„¸íŠ¸(ì§) â€“ í•œ ë²ˆì— í•˜ë‚˜ì˜ ì„¸íŠ¸ë§Œ ì‚¬ìš©
  const SETS = [
    { id:"set1000", name:"1000+500", big:1000, small:500, priority:0 },
    { id:"set950",  name:"950+475",  big:950,  small:475, priority:1 },
    { id:"set900",  name:"900+450",  big:900,  small:450, priority:2 },
    { id:"set850",  name:"850+425",  big:850,  small:425, priority:3 },
    { id:"set800",  name:"800+400",  big:800,  small:400, priority:4 },
  ];

  // ë””ìì¸(í°ì¥ ì „ ì¢…ë¥˜, ì‘ì€ì¥ A/B/C/G/H/Ië§Œ)
  const LETTERS_BIG   = ["A","B","C","D","E","F","G","H","I"];
  const LETTERS_SMALL = ["A","B","C","G","H","I"];

  // ì¸ë„¤ì¼ ê²½ë¡œ
  const THUMB_BIG   = Object.fromEntries(LETTERS_BIG.map(ch   => [ch, `design_${ch}.png`]));
  const THUMB_SMALL = Object.fromEntries(LETTERS_SMALL.map(ch => [ch, `s_design_${ch}.png`]));

  let topRows=[], selections=[], currentPlan=null;

  document.getElementById('calcBtn').addEventListener('click', calculate);
  document.getElementById('wall').addEventListener('keydown', e=>{ if(e.key==='Enter') calculate(); });

  function calculate(){
    const wall = parseInt(document.getElementById('wall').value,10);
    const pairRequired = document.getElementById('pairRequired').checked;
    const onlyOdd = document.getElementById('onlyOddDoors').checked;
    const summary = document.getElementById('summary');
    summary.innerHTML = "";
    document.getElementById('designCard').style.display = "none";

    if(!wall || wall < 1000){
      summary.innerHTML = "<div class='warn'>âš ï¸ ë²½ ê¸¸ì´ë¥¼ 1000mm ì´ìƒìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.</div>";
      return;
    }

    const enabledSets = SETS.filter(s=>document.getElementById(s.id).checked);
    if(enabledSets.length===0){
      summary.innerHTML = "<div class='warn'>âš ï¸ ìµœì†Œ 1ê°œì˜ ì„¸íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>";
      return;
    }

    let rows=[];
    for(const set of enabledSets){
      // í•œ ì„¸íŠ¸ ë‚´ì—ì„œë§Œ í†µ ì¡°í•© íƒìƒ‰(ë¬¸ì§ ë„ˆë¹„ í†µì¼)
      for(let bc=0;bc<=14;bc++){
        for(let sc=0;sc<=14;sc++){
          if(bc===0 && sc===0) continue;
          if(pairRequired && (bc===0 || sc===0)) continue;

          const used = set.big*bc + set.small*sc;
          if(used > wall) continue;

          const leftover = wall - used;
          const surround = leftover/2;
          if(surround < MIN_SURROUND) continue;

          const doors = 2*bc + sc;     // í°ì¥ì€ 2ë„ì–´ ê°€ì •, ì‘ì€ì¥ì€ 1ë„ì–´ ì·¨ê¸‰
          if(onlyOdd && doors%2===0) continue;

          rows.push({set:set.name,big:set.big,small:set.small,bc,sc,used,leftover,surround,doors,priority:set.priority});
        }
      }
    }

    if(rows.length===0){
      summary.innerHTML = "<div class='warn'>ì¡°ê±´ì— ë§ëŠ” ì¡°í•©ì´ ì—†ìŠµë‹ˆë‹¤. ì„¸íŠ¸/ì˜µì…˜ì„ ì¡°ì •í•˜ê±°ë‚˜ ë²½ ê¸¸ì´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>";
      return;
    }

    // ì •ë ¬: ë‚¨ëŠ”í­ ìµœì†Œ â†’ (ë™ë¥ ) ì„¸íŠ¸ ìš°ì„ ìˆœìœ„ â†’ ë„ì–´ ìˆ˜ ì ê²Œ â†’ í†µìˆ˜ ì ê²Œ
    rows.sort((a,b)=>{
      const diff = Math.abs(a.leftover - b.leftover);
      if(diff <= LEFTOVER_TIE_MM && a.priority !== b.priority) return a.priority - b.priority;
      if(a.leftover !== b.leftover) return a.leftover - b.leftover;
      if(a.doors !== b.doors) return a.doors - b.doors;
      return (a.bc+a.sc) - (b.bc+b.sc);
    });

    topRows = rows.slice(0,3);
    summary.innerHTML =
      "<div class='ok'><b>âœ… ì¶”ì²œ ì¡°í•© Top3 (ì„œë¼ìš´ë“œ ìë™ ìµœì í™”)</b></div>" +
      topRows.map((r,i)=>`<div class='summary-line'>
        <button class='btn ghost' onclick='choosePlan(${i})'>${i+1}ì•ˆ ì„ íƒ</button>
        ${r.set} Â· í°ì¥ ${r.bc} Â· ì‘ì€ì¥ ${r.sc} = ì´ ${(r.bc+r.sc)}í†µ
        Â· ë„ì–´ ${r.doors}ê°œ Â· ì„œë¼ìš´ë“œ ${Math.round(r.surround)}mm/ì¸¡ (ë‚¨ëŠ”í­ ${r.leftover}mm)
      </div>`).join("");
  }

  function choosePlan(idx){
    const r = topRows[idx]; currentPlan = r;
    const unitCount = r.bc + r.sc;

    const wrap = document.getElementById('slotsWrap');
    wrap.innerHTML = "";
    selections = Array(unitCount).fill("A");

    for(let i=0;i<unitCount;i++){
      const isSmall = i >= r.bc;
      const letters = isSmall ? LETTERS_SMALL : LETTERS_BIG;
      const defaultLetter = letters[0]; selections[i] = defaultLetter;

      const slot = document.createElement('div'); slot.className="slot";
      const chip = isSmall ? '<span class="chip">ì‘ì€ì¥</span>' : '<span class="chip">í°ì¥</span>';
      const mm   = isSmall ? r.small : r.big;

      slot.innerHTML = `<h3>${i+1}í†µ ${chip} <span class="muted">${mm}mm</span></h3>`;
      const grid = document.createElement('div'); grid.className="thumb-grid";

      letters.forEach(letter=>{
        const div = document.createElement('div');
        div.className = "thumb" + (letter===defaultLetter ? " active" : "");
        div.dataset.letter = letter;

        const img = document.createElement('img');
        img.src = isSmall ? THUMB_SMALL[letter] : THUMB_BIG[letter];
        img.alt = letter;
        div.appendChild(img);

        div.addEventListener('click', ()=>{
          selections[i] = letter;
          grid.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active'));
          div.classList.add('active');
          updateSequences(); renderPreview();
        });

        grid.appendChild(div);
      });

      slot.appendChild(grid);
      wrap.appendChild(slot);
    }

    document.getElementById('designCard').style.display="block";
    updateSequences(); renderPreview();
    window.scrollTo({ top: document.getElementById('designCard').offsetTop - 10, behavior:'smooth' });
  }

  // mm â†’ decimeter ë¬¸ìì—´(ì˜ˆ: 900 â†’ "9", 950 â†’ "9.5")
  function fmtDm(mm){
    const v = mm/100;
    return Number.isInteger(v) ? String(v) : String(v);
  }

  function buildSequenceStrings(){
    if(!currentPlan) return {letters:"-", full:"-", compact:"-"};

    // 1) ë¬¸ì ì‹œí€€ìŠ¤
    const lettersSeq = selections.join("-");

    // 2) ê° í†µ í­(mm)
    const widths = selections.map((_,i)=> i<currentPlan.bc ? currentPlan.big : currentPlan.small);

    // 3) ìƒì„¸í˜•(ê´„í˜¸ í¬í•¨, ê³µë°±ì—†ì´)
    const unitsWithWidth = selections.map((ch,i)=> `${ch}(${widths[i]})`).join("-");
    const surr = Math.round(currentPlan.surround);
    const full = `L${surr}-${unitsWithWidth}-R${surr}`.replace(/\s+/g,"");

    // 4) Compact(ìˆ«ìâ†’ë¬¸ì, L/R ìˆ«ì) ì˜ˆ: 40L-9A-9C-4.5G-40R
    const compactTokens = selections.map((ch,i)=> `${fmtDm(widths[i])}${ch}`);
    const compact = `${surr}L-${compactTokens.join("-")}-${surr}R`.replace(/\s+/g,"");

    return { letters: lettersSeq, full, compact };
  }

  function updateSequences(){
    const {letters, full, compact} = buildSequenceStrings();
    document.getElementById('sequenceBoxLetters').textContent = letters;
    document.getElementById('sequenceBoxFull').textContent    = full;
    document.getElementById('sequenceBoxCompact').textContent = compact;
  }

  async function renderPreview(){
    const canvas = document.getElementById('previewCanvas');
    const ctx = canvas.getContext('2d');
    const unitH=240, labelH=28, gap=8;

    if(!currentPlan){canvas.width=0;canvas.height=0;return;}
    const {bc,sc,big,small,surround} = currentPlan;
    const count = selections.length||0; if(count===0){canvas.width=0;canvas.height=0;return;}

    const basePxPerMm=160/1000; let pxPerMm=basePxPerMm;
    const totalMm=bc*big+sc*small;
    let sPx=Math.max(4,Math.round(surround*pxPerMm));
    let totalW=sPx + (totalMm*pxPerMm) + (gap*(count-1)) + sPx;
    const maxCanvasW=1200;
    if(totalW>maxCanvasW){
      const mmPart=(totalMm*pxPerMm)+(2*sPx);
      const scale=(maxCanvasW - gap*(count-1)) / mmPart;
      pxPerMm *= scale;
      sPx=Math.max(3,Math.round(surround*pxPerMm));
      totalW=Math.round(sPx + (totalMm*pxPerMm) + (gap*(count-1)) + sPx);
    }
    canvas.width=totalW; canvas.height=unitH+labelH;

    // ë°°ê²½
    ctx.fillStyle="#fff"; ctx.fillRect(0,0,canvas.width,canvas.height);

    // ì¢Œ ì„œë¼ìš´ë“œ
    let cursorX=0;
    ctx.fillStyle="#f0f0f0"; ctx.fillRect(cursorX,0,sPx,unitH);
    ctx.strokeStyle="#cfcfcf"; ctx.strokeRect(cursorX+0.5,0.5,sPx-1,unitH-1);
    ctx.fillStyle="#555"; ctx.font="12px system-ui"; ctx.textAlign="center";
    ctx.fillText(`L${Math.round(surround)}mm`, cursorX + sPx/2, unitH - 8);
    cursorX+=sPx;

    // ìœ ë‹›ë“¤
    const unitWidthsMm=selections.map((_,idx)=> idx<bc?big:small);
    for(let i=0;i<count;i++){
      const mm=unitWidthsMm[i];
      const slotW=mm*pxPerMm;
      const letter=selections[i];
      const isSmall = i >= bc;
      const src = isSmall ? THUMB_SMALL[letter] : THUMB_BIG[letter];

      try{
        const img=await loadImage(src);
        // í°ì¥: ë¹„ìœ¨ìœ ì§€, ì‘ì€ì¥: ë†’ì´ ë™ì¼(ê°•ì œ í­ ë§ì¶¤)
        if(!isSmall){
          const ratio=Math.min(slotW/img.width, unitH/img.height);
          const w=Math.round(img.width*ratio);
          const h=Math.round(img.height*ratio);
          const x=cursorX + Math.round((slotW - w)/2);
          const y=Math.round((unitH - h)/2);
          ctx.drawImage(img, x, y, w, h);
        }else{
          ctx.drawImage(img, cursorX, 0, slotW, unitH);
        }
      }catch(e){
        ctx.strokeStyle="#999"; ctx.strokeRect(cursorX+4,4,slotW-8,unitH-8);
        ctx.fillStyle="#333"; ctx.font="bold 22px system-ui"; ctx.textAlign="center";
        ctx.fillText(letter, cursorX + slotW/2, unitH/2 + 8);
      }

      // í°ì¥ ì¤‘ì•™ 3mm ê°„ê²© (ì ì„  2ì¤„)
      if(i<bc){
        const gapPx=Math.max(1, DOOR_GAP_MM * pxPerMm);
        const mid=cursorX + slotW/2;
        ctx.save(); ctx.strokeStyle="#8aa3ff"; ctx.lineWidth=1; ctx.setLineDash([4,4]);
        ctx.beginPath(); ctx.moveTo(Math.round(mid-gapPx/2)+0.5, 0); ctx.lineTo(Math.round(mid-gapPx/2)+0.5, unitH); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(Math.round(mid+gapPx/2)+0.5, 0); ctx.lineTo(Math.round(mid+gapPx/2)+0.5, unitH); ctx.stroke();
        ctx.restore();
      }

      // í•˜ë‹¨ í­ ë¼ë²¨
      ctx.fillStyle="#111"; ctx.font="12px system-ui"; ctx.textAlign="center";
      ctx.fillText(`${mm}mm`, cursorX + slotW/2, unitH + labelH - 8);

      cursorX += slotW + (i<count-1 ? gap : 0);
    }

    // ìš° ì„œë¼ìš´ë“œ
    ctx.fillStyle="#f0f0f0"; ctx.fillRect(cursorX,0,sPx,unitH);
    ctx.strokeStyle="#cfcfcf"; ctx.strokeRect(cursorX+0.5,0.5,sPx-1,unitH-1);
    ctx.fillStyle="#555"; ctx.font="12px system-ui"; ctx.textAlign="center";
    ctx.fillText(`R${Math.round(surround)}mm`, cursorX + sPx/2, unitH - 8);
  }

  function loadImage(src){
    return new Promise((res, rej)=>{
      const img=new Image(); img.onload=()=>res(img); img.onerror=rej; img.src=src;
    });
  }

  function copyText(id){
    const t=document.getElementById(id).textContent;
    if(!t || t==='-'){ alert('ë¨¼ì € ì‹œí€€ìŠ¤ë¥¼ ìƒì„±í•˜ì„¸ìš”.'); return; }
    navigator.clipboard.writeText(t).then(()=>alert("ë³µì‚¬ë¨"));
  }
</script>
</body>
</html>
