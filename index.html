<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë¶™ë°•ì´ì¥ ìë™ ì„¤ê³„ ê³„ì‚°ê¸° v11 (COMPACT Â· ì €ì¥ë³µêµ¬ Â· 850/950 í¬í•¨)</title>
<style>
  :root{
    --blue:#2563eb; --muted:#6b7280; --red:#d12c2c; --black:#111;
    --bg:#f7f8fb; --card:#fff; --border:#e5e7eb;
  }
  body{margin:0;background:var(--bg);color:#1f2937;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif}
  .container{max-width:1000px;margin:0 auto;padding:20px 14px 160px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 14px rgba(0,0,0,.05);padding:16px;margin-bottom:16px}
  h1{margin:0 0 8px;font-size:20px} h2{margin:0 0 12px;font-size:16px}
  .muted{color:var(--muted);font-size:13px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media (max-width:760px){.row{grid-template-columns:1fr}}
  input[type="number"]{width:100%;padding:8px 10px;border:1px solid #cbd5e1;border-radius:8px}
  label.inline{display:flex;align-items:center;gap:8px}
  .checks{display:flex;gap:12px;flex-wrap:wrap}
  .btn{border:0;border-radius:10px;background:var(--blue);color:#fff;padding:9px 14px;cursor:pointer;font-size:14px}
  .btn.ghost{background:transparent;color:var(--blue);border:1px solid var(--blue)}
  .slot{border:1px solid #eaf0f5;border-radius:12px;padding:10px;margin-bottom:12px}
  .thumb-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
  .thumb{border:2px solid transparent;border-radius:10px;overflow:hidden;background:#fff;cursor:pointer}
  .thumb.active{border-color:var(--blue);box-shadow:0 0 0 3px rgba(37,99,235,.2)}
  .thumb img{display:block;width:100%;height:auto}
  .seq{background:#fff;border:1px solid var(--border);border-radius:10px;padding:10px;font-family:ui-monospace,Menlo,Consolas,monospace}
  .seq small{color:var(--muted)}
  .seq .r{color:var(--red);font-weight:600}
  .seq .k{color:var(--black);font-weight:700}
  .preview-box{border:1px solid var(--border);border-radius:12px;background:#fff;display:flex;justify-content:center;align-items:center;min-height:140px;overflow:auto}
  .summary-line{margin:6px 0}
  .chip{font-size:11px;padding:2px 8px;border-radius:999px;background:#eef2ff;color:#1e3a8a;border:1px solid #c7d2fe}
  .sticky{position:fixed;left:0;right:0;bottom:0;background:rgba(255,255,255,.97);border-top:1px solid var(--border);backdrop-filter:blur(6px);padding:10px 14px;display:grid;grid-template-columns:1fr auto;gap:10px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>ğŸ“ ë¶™ë°•ì´ì¥ ìë™ ì„¤ê³„ ê³„ì‚°ê¸° v11</h1>
    <div class="muted"><b>ì‹¤ì œ í­(mm) ë¹„ìœ¨</b> Â· <b>í°ì¥ ë„ì–´ ì¤‘ì•™ 3mm ì ì„ </b> Â· <b>ì‘ì€ì¥: ë†’ì´ ë™ì¼Â·í­ ì ˆë°˜</b> Â· <b>ë¯¸ë¦¬ë³´ê¸°: í†µë¼ë¦¬ ì™„ì „ ë°€ì°©</b></div>
  </div>

  <div class="card">
    <h2>ì…ë ¥</h2>
    <div class="summary-line">
      <label>ë²½ ì „ì²´ ê¸¸ì´ (mm)<br>
        <input id="wall" type="number" value="3700" min="1000" placeholder="ì˜ˆ: 3700">
      </label>
    </div>
    <div class="summary-line">
      <b>í—ˆìš© ì„¸íŠ¸</b>
      <div class="checks">
        <label class="inline"><input type="checkbox" id="set105" checked> 1000 + 500</label>
        <label class="inline"><input type="checkbox" id="set95"  checked> 950 + 475</label>
        <label class="inline"><input type="checkbox" id="set90"  checked> 900 + 450</label>
        <label class="inline"><input type="checkbox" id="set85"  checked> 850 + 425</label>
        <label class="inline"><input type="checkbox" id="set80"  checked> 800 + 400</label>
      </div>
    </div>
    <div class="summary-line">
      <b>ì¶”ê°€ ì˜µì…˜</b>
      <div class="checks">
        <label class="inline"><input type="checkbox" id="pairRequired"> ì§ í•„ìˆ˜(í°ì¥+ì‘ì€ì¥ ë™ì‹œ)</label>
        <label class="inline"><input type="checkbox" id="onlyOddDoors"> í™€ìˆ˜ ë„ì–´ë§Œ</label>
      </div>
    </div>
    <button class="btn" id="calcBtn">ê³„ì‚°í•˜ê¸°</button>
    <div id="summary" style="margin-top:10px;"></div>
  </div>

  <div class="card" id="designCard" style="display:none;">
    <h2>ë””ìì¸ ì„ íƒ (A~I)</h2>
    <div class="row">
      <div>
        <div id="slotsWrap"></div>
      </div>
      <div>
        <div class="preview-box"><canvas id="previewCanvas"></canvas></div>

        <div style="margin-top:12px">
          <label>COMPACT ì‹œí€€ìŠ¤ <small>(ê³µë°± ì—†ìŒ Â· <span class="k">ê²€ì •=L/R</span>, <span class="r">ë¹¨ê°•=ê° í†µ</span>)</small></label>
          <div id="seqCompact" class="seq">-</div>
          <button class="btn" style="margin-top:8px" onclick="copyText('seqCompact')">ë³µì‚¬</button>
        </div>

        <div style="margin-top:12px">
          <label>ìŠ¤ë§ˆíŠ¸ìŠ¤í† ì–´ ì…ë ¥ìš© <small>(ìƒ‰ìƒ ì•ˆë‚´ Â· ê³µë°± ì—†ìŒ)</small></label>
          <div id="seqStore" class="seq">-</div>
          <button class="btn" style="margin-top:8px" onclick="copyText('seqStore')">ë³µì‚¬</button>
          <div class="muted" style="margin-top:8px">
            â€¢ ë³µì‚¬í•œ ê²°ê³¼ëŠ” <b>ìƒí’ˆ ì˜µì…˜ ì²« ì¹¸(ì‚¬ì´ì¦ˆ&ë””ìì¸ êµ¬ì„±)</b>ì— ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.<br>
            â€¢ <span class="r">ë¹¨ê°•</span>ìœ¼ë¡œ í‘œì‹œëœ <b>í†µ(ì˜ˆ: 9A, 9Fâ€¦)</b>ë§Œ ì¥ë°”êµ¬ë‹ˆì— ìˆœì„œëŒ€ë¡œ ë‹´ì•„ ì£¼ì„¸ìš”. (L/Rì€ ì„œë¼ìš´ë“œë¼ ë‹´ì§€ ì•ŠìŒ)
          </div>
          <div class="muted" style="margin-top:6px">
            ê²€ì •=<b>L/R ì„œë¼ìš´ë“œ</b>, <span class="r">ë¹¨ê°•</span>=<b>ê° í†µ(ìˆ«ì=ì•ŒíŒŒë²³)</b> Â· ì˜ˆ) <b>50<span class="k">L</span>-<span class="r">9A-9F-9E-9I</span>-<span class="k">50R</span></b>
          </div>
        </div>

        <div style="margin-top:14px">
          <button class="btn" onclick="downloadPreview()">ìµœì¢…ì´ë¯¸ì§€ ì €ì¥</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="sticky">
  <div class="muted">ê³„ì‚° â†’ ì¶”ì²œì•ˆ ì„ íƒ â†’ ë””ìì¸ ì„ íƒ â†’ ì‹œí€€ìŠ¤/ì´ë¯¸ì§€ ì €ì¥</div>
  <button class="btn" onclick="calculate()">ê³„ì‚°í•˜ê¸°</button>
</div>

<script>
const MIN_SURROUND = 40;
const DOOR_GAP_MM  = 3;
const LEFTOVER_TIE = 20;

const SETS = [
  { id:"set105", name:"1000+500", big:1000, small:500, priority:0 },
  { id:"set95",  name:"950+475",  big:950,  small:475, priority:1 },
  { id:"set90",  name:"900+450",  big:900,  small:450, priority:2 },
  { id:"set85",  name:"850+425",  big:850,  small:425, priority:3 },
  { id:"set80",  name:"800+400",  big:800,  small:400, priority:4 },
];

const LETTERS_BIG   = ["A","B","C","D","E","F","G","H","I"];
const LETTERS_SMALL = ["A","B","C","G","H","I"]; // ì‘ì€ì¥ ì´ë¯¸ì§€ ì„¸íŠ¸
const IMG = Object.fromEntries(LETTERS_BIG.map(ch => [ch, `design_${ch}.png`]));

let topRows=[], selections=[], currentPlan=null;

document.getElementById('calcBtn').addEventListener('click', calculate);
document.getElementById('wall').addEventListener('keydown', e=>{ if(e.key==='Enter') calculate(); });

function mmToDmStr(mm){
  const dm = mm/100; // 100mm = 1dm
  // 950 -> 9.5, 1000 -> 10
  return (Math.round(dm*10)/10).toString().replace(/\.0$/,'');
}
function surroundDmStr(mm){
  const dm = Math.round(mm/10); // 10mm = 1ì‹­mm ë‹¨ìœ„ë¡œ ë°˜ì˜¬ë¦¼
  return dm.toString();
}

function calculate(){
  const wall = parseInt(document.getElementById('wall').value,10);
  const pairRequired = document.getElementById('pairRequired').checked;
  const onlyOdd      = document.getElementById('onlyOddDoors').checked;
  const summary = document.getElementById('summary');
  summary.innerHTML=""; document.getElementById('designCard').style.display="none";

  if(!wall || wall<1000){ summary.innerHTML="<div style='color:#b00020'>âš ï¸ 1000mm ì´ìƒ ì…ë ¥</div>"; return; }

  const enabled = SETS.filter(s => document.getElementById(s.id).checked);
  if(enabled.length===0){ summary.innerHTML="<div style='color:#b00020'>âš ï¸ ìµœì†Œ 1ê°œ ì„¸íŠ¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>"; return; }

  let rows=[];
  for(const set of enabled){
    for(let bc=0;bc<=14;bc++){
      for(let sc=0;sc<=14;sc++){
        if(bc===0&&sc===0) continue;
        if(pairRequired && (bc===0 || sc===0)) continue;
        const used = set.big*bc + set.small*sc;
        if(used>wall) continue;
        const leftover = wall - used;
        const surround = leftover/2;
        if(surround<MIN_SURROUND) continue;
        const doors = 2*bc + sc; // í°ì¥=2, ì‘ì€ì¥=1
        if(onlyOdd && doors%2===0) continue;
        rows.push({set:set.name,big:set.big,small:set.small,bc,sc,used,leftover,surround,doors,priority:set.priority});
      }
    }
  }
  if(rows.length===0){ summary.innerHTML="<div style='color:#b00020'>ì¡°ê±´ì— ë§ëŠ” ì¡°í•© ì—†ìŒ</div>"; return; }

  rows.sort((a,b)=>{
    const near = Math.abs(a.leftover-b.leftover)<=LEFTOVER_TIE;
    if(near && a.priority!==b.priority) return a.priority-b.priority;
    if(a.leftover!==b.leftover) return a.leftover-b.leftover;
    if(a.doors!==b.doors) return a.doors-b.doors;
    return (a.bc+a.sc)-(b.bc+b.sc);
  });

  topRows = rows.slice(0,3);
  summary.innerHTML = "<div style='color:#087443'><b>âœ… ì¶”ì²œ ì¡°í•© Top3 (ì„œë¼ìš´ë“œ ìš°ì„ )</b></div>" +
    topRows.map((r,i)=>`
      <div class='summary-line'>
        <button class='btn ghost' onclick='choosePlan(${i})'>${i+1}ì•ˆ ì„ íƒ</button>
        ${r.set} Â· í°ì¥${r.bc} ì‘ì€ì¥${r.sc} = ì´ ${(r.bc+r.sc)}í†µ Â· ë„ì–´ ${r.doors}ê°œ Â·
        ì„œë¼ìš´ë“œ ${Math.round(r.surround)}mm/ì¸¡ (ë‚¨ëŠ”í­ ${r.leftover}mm)
      </div>
    `).join("");
}

function choosePlan(idx){
  const r=topRows[idx]; currentPlan=r;
  const unitCount=r.bc+r.sc;
  const wrap=document.getElementById('slotsWrap'); wrap.innerHTML="";
  selections = Array(unitCount).fill("A");

  for(let i=0;i<unitCount;i++){
    const isSmall = i>=r.bc;
    const letters = isSmall? LETTERS_SMALL : LETTERS_BIG;
    const defaultLetter = letters[0];
    selections[i] = defaultLetter;

    const slot = document.createElement('div'); slot.className="slot";
    slot.innerHTML = `<h3>${i+1}í†µ ${isSmall?'<span class="chip">ì‘ì€ì¥</span>':'<span class="chip">í°ì¥</span>'}
                      <span class="muted">${isSmall?r.small:r.big}mm</span></h3>`;
    const grid = document.createElement('div'); grid.className="thumb-grid";
    letters.forEach(letter=>{
      const div=document.createElement('div'); div.className="thumb"+(letter===defaultLetter?" active":"");
      const img=document.createElement('img'); img.src=IMG[letter]; img.alt=letter;
      div.appendChild(img);
      div.addEventListener('click',()=>{
        selections[i]=letter;
        grid.querySelectorAll('.thumb').forEach(t=>t.classList.remove('active'));
        div.classList.add('active');
        updateSequences(); renderPreview();
      });
      grid.appendChild(div);
    });
    slot.appendChild(grid); wrap.appendChild(slot);
  }

  document.getElementById('designCard').style.display="block";
  updateSequences(); renderPreview();
  window.scrollTo({ top: document.getElementById('designCard').offsetTop-10, behavior:'smooth' });
}

function buildSequences(){
  if(!currentPlan) return { compact:"-", store:"-" };
  const widths = selections.map((_,i)=> i<currentPlan.bc ? currentPlan.big : currentPlan.small);
  const surr = Math.round(currentPlan.surround);

  // COMPACT: 0L-10A-9.5B-...-50R (ì‹­cm ë‹¨ìœ„)
  const left  = surroundDmStr(surr)+"L";
  const right = surroundDmStr(surr)+"R";
  const mids  = selections.map((ch,i)=> `<span class="r">${mmToDmStr(widths[i])}${ch}</span>`).join("-");
  const compactHtml = `<span class="k">${left}</span>-` + mids + `-<span class="k">${right}</span>`;

  // STORE: 50L-9A-9F-...-50R (ë””ì‹œë¯¸í„°, ê³µë°±X)
  const mids2 = selections.map((ch,i)=> `<span class="r">${mmToDmStr(widths[i])}${ch}</span>`).join("-");
  const storeHtml = `<span class="k">${mmToDmStr(surr*10)}L</span>-` + mids2 + `-<span class="k">${mmToDmStr(surr*10)}R</span>`;

  return {compactHtml, storeHtml};
}
function updateSequences(){
  const {compactHtml,storeHtml} = buildSequences();
  document.getElementById('seqCompact').innerHTML = compactHtml || "-";
  document.getElementById('seqStore').innerHTML   = storeHtml   || "-";
}

async function renderPreview(){
  const canvas=document.getElementById('previewCanvas'), ctx=canvas.getContext('2d');
  const unitH=260, labelH=26, gap=0; // í†µë¼ë¦¬ ì™„ì „ ë°€ì°©
  if(!currentPlan){canvas.width=0;canvas.height=0;return;}
  const {bc,sc,big,small,surround}=currentPlan;
  const count=selections.length||0; if(count===0){canvas.width=0;canvas.height=0;return;}

  let pxPerMm=0.16; // ê¸°ì¤€ ìŠ¤ì¼€ì¼
  let sPx=Math.max(3,Math.round(surround*pxPerMm));
  const totalMm=bc*big+sc*small;
  let totalW = sPx + (totalMm*pxPerMm) + (gap*(count-1)) + sPx;
  const maxW=1200;
  if(totalW>maxW){
    const mmPart=(totalMm*pxPerMm)+(2*sPx);
    const scale=(maxW - gap*(count-1)) / mmPart;
    pxPerMm*=scale; sPx=Math.max(3,Math.round(surround*pxPerMm));
    totalW=Math.round(sPx + (totalMm*pxPerMm) + (gap*(count-1)) + sPx);
  }
  canvas.width=totalW; canvas.height=unitH+labelH;

  ctx.fillStyle="#fff"; ctx.fillRect(0,0,canvas.width,canvas.height);
  let x=0;

  // ì¢Œ ì„œë¼ìš´ë“œ(íšŒìƒ‰ ë°•ìŠ¤)
  ctx.fillStyle="#f0f0f0"; ctx.fillRect(x,0,sPx,unitH);
  ctx.strokeStyle="#cfcfcf"; ctx.strokeRect(x+0.5,0.5,sPx-1,unitH-1);
  ctx.fillStyle="#555"; ctx.font="12px system-ui"; ctx.textAlign="center";
  ctx.fillText(`L${Math.round(surround)}mm`, x + sPx/2, unitH-8);
  x+=sPx;

  const widthsMm=selections.map((_,i)=> i<bc?big:small);
  for(let i=0;i<count;i++){
    const mm=widthsMm[i], w=mm*pxPerMm, letter=selections[i], src=IMG[letter];
    try{
      const img=await loadImage(src);
      if(i<bc){
        const ratio=Math.min(w/img.width, unitH/img.height);
        const dw=Math.round(img.width*ratio), dh=Math.round(img.height*ratio);
        const ix=x + Math.round((w-dw)/2), iy=Math.round((unitH-dh)/2);
        ctx.drawImage(img, ix, iy, dw, dh);
        // ì¤‘ì•™ 3mm ì´ì¤‘ ì ì„ 
        const gapPx=Math.max(1, DOOR_GAP_MM*pxPerMm);
        const mid=x + w/2;
        ctx.save(); ctx.strokeStyle="#8aa3ff"; ctx.lineWidth=1; ctx.setLineDash([4,4]);
        ctx.beginPath(); ctx.moveTo(Math.round(mid-gapPx/2)+0.5,0); ctx.lineTo(Math.round(mid-gapPx/2)+0.5,unitH); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(Math.round(mid+gapPx/2)+0.5,0); ctx.lineTo(Math.round(mid+gapPx/2)+0.5,unitH); ctx.stroke();
        ctx.restore();
      }else{
        // ì‘ì€ì¥: ë†’ì´ ë™ì¼, í­ ì ˆë°˜ ê°•ì œ ë§ì¶¤
        ctx.drawImage(img, x, 0, w, unitH);
      }
    }catch(e){
      ctx.strokeStyle="#999"; ctx.strokeRect(x+4,4,w-8,unitH-8);
      ctx.fillStyle="#333"; ctx.font="bold 22px system-ui"; ctx.textAlign="center";
      ctx.fillText(letter, x + w/2, unitH/2 + 8);
    }
    ctx.fillStyle="#111"; ctx.font="12px system-ui"; ctx.textAlign="center";
    ctx.fillText(`${mm}mm`, x + w/2, unitH + labelH - 8);
    x += w + (i<count-1 ? gap : 0);
  }

  // ìš° ì„œë¼ìš´ë“œ
  ctx.fillStyle="#f0f0f0"; ctx.fillRect(x,0,sPx,unitH);
  ctx.strokeStyle="#cfcfcf"; ctx.strokeRect(x+0.5,0.5,sPx-1,unitH-1);
  ctx.fillStyle="#555"; ctx.fillText(`R${Math.round(surround)}mm`, x + sPx/2, unitH-8);
}

function loadImage(src){ return new Promise((res,rej)=>{ const i=new Image(); i.onload=()=>res(i); i.onerror=rej; i.src=src; }); }
function downloadPreview(){
  const c=document.getElementById('previewCanvas');
  if(!c||c.width===0){ alert("ë¨¼ì € ë””ìì¸ì„ ì„ íƒí•˜ì„¸ìš”."); return; }
  const a=document.createElement('a'); a.href=c.toDataURL("image/png"); a.download="ìµœì¢…ì¡°ë¦½ë¯¸ë¦¬ë³´ê¸°.png"; a.click();
}
function copyText(id){
  // íƒœê·¸ ì œê±°í•´ì„œ í…ìŠ¤íŠ¸ë§Œ ë³µì‚¬
  const raw = document.getElementById(id).innerHTML
    .replace(/<span[^>]*>/g,'').replace(/<\/span>/g,'');
  if(!raw || raw==='-'){ alert('ë¨¼ì € ì‹œí€€ìŠ¤ë¥¼ ìƒì„±í•˜ì„¸ìš”.'); return; }
  navigator.clipboard.writeText(raw).then(()=>alert("ë³µì‚¬ë¨"));
}
</script>
</body>
</html>
